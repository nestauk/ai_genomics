# Patent Data Pipeline

## Getting AI and genomics- related CPC codes

CPC classificaion code data comes from the [European Patent Office](https://www.epo.org/searching-for-patents/helpful-resources/first-time-here/classification/cpc.html).

Codes are defined as "ai" related if ai keywords are are in the descriptions of classification codes. They are then manually verified and 'good' codes are also added.

Codes are defined as "genomics" from a validation exercise with a number of genomics experts. The initial list of CPC codes was generated by identifying CPC codes with genomics keywords in it. The list was then curated based on whether validators felt the code was relevant or not. Validators also suggested missing genomics areas - additional CPC codes were subsequently added to the list of relevant genomics CPC codes based on their advice.

To generate CPC codes, run:

`python ai_genomics/pipeline/patent_data/get_cpc_codes.py`

## Getting AI genomics patents

To run `get_ai_genomics_patents.py`, you must first have a service account credentials .json. To create a service account credentials file, [follow these instructions.](https://cloud.google.com/iam/docs/creating-managing-service-accounts)

Before you run the `get_ai_genomics_patents.py` script, you will need to export your credentials path as an global variable every time you want to run the script. To do so, (in your terminal):

`export GOOGLE_APPLICATION_CREDENTIALS="/path/to/credentials.json"`

Alternatively, you could also set these credentials as an environmental variable in `.bashrc`. Your credentials will need specific permissions to pull data from BigQuery and you will get a permissions error should you not have access. If not, reach out to India Kerle to be granted table access.

To identify and save AI and genomics related patents to s3, run:

`python ai_genomics/pipeline/patent_data/get_ai_genomics_patents.py`

This will get unique patents from: 1. ai_genomics: the AI and genomics table; 2. ai_sample: A sample of 10% of patents with AI codes; 3. genomics_sample: A sample of 5% of patents with genomics codes;

in BigQuery and save them to s3.

These tables were first created and verified for data download limitations in BigQuery's front end. Functions to generate the queries used to generate these tables are in the script.

Finally, to add the full list of CPC codes associated to a publication number, run:

`python ai_genomics/pipeline/patent_data/add_full_cpc_codes.py`

This will add the full list of CPC codes associated to a patent document across AI genomics, a sample of AI and a sample of genomics related patents. These updated tables are also to s3.
